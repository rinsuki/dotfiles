#!/usr/bin/python3
import json
import subprocess
import os.path

p = subprocess.run(["xcrun", "simctl", "list", "--json"], capture_output=True, text=True)
sim_data = json.loads(p.stdout)

for version, devices in sim_data["devices"].items():
    for device in devices:
        if os.path.exists(os.path.join(device["dataPath"], "Containers")):
            continue
        print(f"Deleting simulator: {device['name']} ({device['udid']}) @ {version}")
        subprocess.run(["xcrun", "simctl", "delete", device["udid"]])